In this lab, first at all we need to identify that when we send the password with the parameter invalid, and we add the where function, we are able to see to different messages. Through this way we know that we can get some information
![[Pasted image 20250220215915.png]]
Then, we can try to get the different parameters associated to each user, as for example, username password email. 
Here I was stuck for a couple of hours, 'cause only when you send the request to update Carlos' password is when this parameter is created. After of that you can obtain the last parameter call unlockToken. In the capture I put 4, cause this is the position in some type of array or chain.
With the script below and using the burp's intruder we can get the "parameter". 
![[Pasted image 20250223235037.png]]
Finally here is the last script to get the unlockToken's value. Which we will use to reset the password.

![[Pasted image 20250223235014.png]]
![[Pasted image 20250223235951.png]]



Here I will leave the steps which we get from the web, only to keep the scripts

1. 1. Add `"$where": "0"` as an additional parameter in the JSON data as follows: `{"username":"carlos","password":{"$ne":"invalid"}, "$where": "0"}`
    1. Send the request. Notice that you receive an `Invalid username or password` error message.
    2. Change `"$where": "0" to "$where": "1"`, then resend the request. Notice that you receive an `Account locked` error message. This indicates that the JavaScript in the `$where` clause is being evaluated.
2. Right-click the request and select **Send to Intruder**.
    
3. In Intruder, construct an attack to identify all the fields on the user object:
    
    1. Update the `$where` parameter as follows: `"$where":"Object.keys(this)[1].match('^.{}.*')"`
    2. Add two payload positions. The first identifies the character position number, and the second identifies the character itself: `"$where":"Object.keys(this)[1].match('^.{§§}§§.*')"`

Keep the settings from your previous attack, but update the `$where` parameter as follows: `"$where":"this.YOURTOKENNAME.match('^.{§§}§§.*')"`